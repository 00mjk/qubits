// Generated by CoffeeScript 1.10.0
(function() {
  module.exports = function(arg) {
    var commandHandlers, dispatch, eventBus, eventStore, properties, sendEvents;
    eventStore = arg.eventStore, eventBus = arg.eventBus, commandHandlers = arg.commandHandlers;
    sendEvents = function(events) {
      eventStore.add(events);
      return eventBus != null ? typeof eventBus.publish === "function" ? eventBus.publish(events) : void 0 : void 0;
    };
    dispatch = function(command) {
      var name;
      return Promise.resolve(typeof commandHandlers[name = command.name] === "function" ? commandHandlers[name](command.message) : void 0).then(sendEvents)["catch"](function(error) {
        return console.error(error);
      });
    };
    properties = {
      dispatch: {
        value: dispatch
      }
    };
    return Object.defineProperties({}, properties);
  };

}).call(this);
