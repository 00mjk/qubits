// Generated by CoffeeScript 1.10.0
(function() {
  module.exports = function(arg) {
    var commandHandlers, dispatch, eventBus, eventStore, properties, sendEvents;
    eventStore = arg.eventStore, eventBus = arg.eventBus, commandHandlers = arg.commandHandlers;
    sendEvents = function(events) {
      eventStore.add(events);
      return eventBus != null ? typeof eventBus.publish === "function" ? eventBus.publish(events) : void 0 : void 0;
    };
    dispatch = function(command) {
      var _events, name;
      _events = typeof commandHandlers[name = command.name] === "function" ? commandHandlers[name](command.message) : void 0;
      if (_events.then != null) {
        _events.then(sendEvents);
      } else {
        sendEvents(_events);
      }
      return _events;
    };
    properties = {
      dispatch: {
        value: dispatch
      }
    };
    return Object.defineProperties({}, properties);
  };

}).call(this);
