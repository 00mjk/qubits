// Generated by CoffeeScript 1.10.0
(function() {
  var assign;

  assign = require('./deepAssign');

  module.exports = function(arg) {
    var factory, idGenerator, methods, name, sourcing, state;
    name = arg.name, idGenerator = arg.idGenerator, state = arg.state, methods = arg.methods, sourcing = arg.sourcing;
    if (name == null) {
      name = 'Aggregate';
    }
    factory = function(attrs) {
      var aggregate, fn, instanceId, instanceState, ref;
      instanceId = null;
      if ((idGenerator != null) === false) {
        if (!!attrs.id === false) {
          throw new Error("An id must be provided when creating an instance of " + name);
        } else {
          instanceId = attrs.id;
          delete attrs.id;
        }
      } else {
        instanceId = (ref = attrs.id) != null ? ref : idGenerator();
      }
      instanceState = assign({}, state, attrs);
      aggregate = Object.defineProperty({}, 'state', {
        value: instanceState
      });
      for (name in methods) {
        fn = methods[name];
        Object.defineProperty(aggregate, name, {
          value: fn
        });
      }
      return Object.defineProperty(aggregate, 'id', {
        value: instanceId
      });
    };
    factory.__aggregate_name__ = name.trim();
    factory.__sourcing_methods__ = assign({}, sourcing);
    return factory;
  };

}).call(this);
